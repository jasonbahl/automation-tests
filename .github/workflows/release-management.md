# Release Management Workflow

This document outlines the requirements and implementation details for the Release Management workflow.

## Overview

The Release Management workflow is responsible for collecting changesets, determining the appropriate version bump (major, minor, patch), updating version numbers in files, generating changelogs, and initiating the build and deployment processes.

## Workflow Triggers

- When a PR from develop to main is merged
- Manual trigger via GitHub Actions UI
- Scheduled trigger (e.g., weekly/monthly)

## Workflow Steps

### 1. Extract Release Notes

- When a PR from develop to main is merged, extract release notes from the PR body
- The PR body contains formatted release notes generated by the changeset workflow
- Extract the content between "## Upcoming Changes" and the disclaimer

### 2. Collect and Analyze Changesets

- Read all changesets from the `.changesets` directory
- Determine the appropriate version bump:
  - Major: If any changeset indicates a breaking change
  - Minor: If any changeset is of type "feat" (new feature)
  - Patch: If all changesets are of type "fix", "docs", etc.

### 3. Update Version Numbers

- Update version in `automation-tests.php`
- Update version in `constants.php`
- Update any other files that contain version references

### 4. Generate Changelog

- Use the extracted release notes or generate formatted changelog entries from changesets
- Update `CHANGELOG.md` with new entries
- Update `readme.txt` with new entries
- Include full links to PRs (e.g., `https://github.com/username/repo/pull/123`)
- Highlight breaking changes with prominent warnings
- Add upgrade notice section for breaking changes in `readme.txt`
- Categorize changes by type (breaking changes, features, bug fixes)

### 5. Build Process

- Install Composer dependencies
- Install npm dependencies
- Run build scripts

### 6. Create GitHub Release

- Create a new tag based on the version number
- Create a GitHub release with the tag
- Include the formatted release notes in the release body
- Upload build artifacts to the release

### 7. Archive Changesets

- Move processed changesets to the `.changesets/archive` directory
- Commit the archived changesets
- Update the develop branch with the archived changesets

## Integration with Changeset Generation

The Release Management workflow works in tandem with the Changeset Generation workflow:

1. The Changeset Generation workflow creates changesets for merged PRs
2. It also creates or updates a release PR from develop to main
3. The release PR contains formatted release notes from all changesets
4. When the release PR is merged to main, the Release Management workflow is triggered
5. It extracts the release notes from the PR body and uses them for the GitHub release

This integration ensures a smooth, automated release process with minimal manual intervention.

## GitHub Action Implementation

```yaml
name: Release Management

on:
  pull_request_target:
    types: [closed]
    branches:
      - main
  workflow_dispatch:
    inputs:
      release_type:
        description: 'Force a specific release type (leave empty for auto-detection)'
        required: false
        type: choice
        options:
          - auto
          - major
          - minor
          - patch
        default: 'auto'
      target_branch:
        description: 'Target branch for manual release (usually develop)'
        required: false
        default: 'develop'
  schedule:
    # Run on the 1st and 15th of each month
    - cron: '0 0 1,15 * *'

jobs:
  prepare-release:
    # Only run if:
    # 1. PR from develop to main is merged, OR
    # 2. Manually triggered, OR
    # 3. Scheduled run
    if: (github.event_name == 'pull_request_target' && github.event.pull_request.merged == true && github.event.pull_request.head.ref == 'develop') || github.event_name == 'workflow_dispatch' || github.event_name == 'schedule'
    runs-on: ubuntu-latest
    steps:
      # Checkout code
      # Setup Node.js
      # Install dependencies
      # Extract release notes from PR body or generate them
      # Determine version bump
      # Update version numbers
      # Generate changelog
      # Build dependencies
      # Create GitHub release
      # Archive changesets
```

## Considerations and Next Steps

- Decide on the frequency of releases
- Determine how to handle emergency/hotfix releases
- Create scripts for version bumping and changelog generation
- Set up test environment for validating releases
- Consider how to handle release notes for different audiences (developers vs. users)
- Plan for handling release candidates or beta releases 